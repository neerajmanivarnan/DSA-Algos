// my calender 2 

import java.util.TreeMap;

class MyCalendarTwo {
    private TreeMap<Integer, Integer> bookings;
    private TreeMap<Integer, Integer> overlaps;

    public MyCalendarTwo() {
        bookings = new TreeMap<>();
        overlaps = new TreeMap<>();
    }

    public boolean book(int start, int end) {
        // Check for overlaps with double bookings
        for (int overlapStart : overlaps.keySet()) {
            int overlapEnd = overlaps.get(overlapStart);
            if (Math.max(start, overlapStart) < Math.min(end, overlapEnd)) {
                return false; // Triple booking detected
            }
        }

        // Add the overlap to the overlaps map if it's valid
        for (int bookStart : bookings.keySet()) {
            int bookEnd = bookings.get(bookStart);
            if (Math.max(start, bookStart) < Math.min(end, bookEnd)) {
                int newStart = Math.max(start, bookStart);
                int newEnd = Math.min(end, bookEnd);
                overlaps.put(newStart, newEnd);
            }
        }

        // Book the current event
        bookings.put(start, end);
        return true;
    }
}

